# Webhook Security Demo — HMAC + Nonce + Timestamp

This project demonstrates a secure webhook implementation in **Node.js** using:

- **HMAC (Hash-based Message Authentication Code)** — Ensures the payload is authentic and unchanged.
- **Timestamp** — Rejects old requests to prevent delayed replay attacks.
- **Nonce (One-Time ID)** — Prevents replay within the allowed time window.

---

## 🔍 Why This Matters

When your server receives a webhook from a 3rd-party app, how do you know:

- The request wasn’t tampered with?
- It wasn’t resent by an attacker later (replay attack)?
- It’s actually coming from the trusted sender?

This demo answers those questions by combining:

1. **Shared Secret** — Only sender & receiver know it.
2. **HMAC Signature** — Generated by hashing (`timestamp + '.' + nonce + '.' + payload`) with the secret.
3. **Freshness Check** — Timestamp must be within a small time window (default 5 min).
4. **Nonce Tracking** — Rejects any nonce that’s already been seen.

---

## 📂 Project Structure

                                                (Setup Phase - done once)
                                 ┌────────────────────────────┐
                                 │  You (Server Owner)        │
                                 │  - Pick WEBHOOK_SECRET     │
                                 │  - Configure on:           │
                                 │    a) Your server code     │
                                 │    b) GitHub/Stripe config │
                                 └────────────────────────────┘
                                               │
                                               │ Shared via dashboard setup, NOT over the network
                                               ▼
                                 ┌────────────────────────────┐
                                 │  Webhook Sender            │
                                 │  (GitHub/Stripe)           │
                                 │  - Stores WEBHOOK_SECRET   │
                                 └────────────────────────────┘
                                
                                
                                                (Every Webhook Event)
                                 ┌────────────────────────────┐
                                 │ Webhook Sender              │
                                 │ 1. Takes JSON payload       │
                                 │ 2. Computes:                │
                                 │    signature = HMAC_SHA256( │
                                 │        payload,             │
                                 │        WEBHOOK_SECRET       │
                                 │    )                        │
                                 │ 3. Sends:                   │
                                 │    POST /webhook            │
                                 │    x-signature: <signature> │
                                 │    body: <payload>          │
                                 └────────────────────────────┘
                                               │
                                               ▼
                                 ┌────────────────────────────┐
                                 │ Your Server                 │
                                 │ 1. Receives request         │
                                 │ 2. Reads x-signature header │
                                 │ 3. Computes:                │
                                 │    expected = HMAC_SHA256(  │
                                 │        payload,             │
                                 │        WEBHOOK_SECRET       │
                                 │    )                        │
                                 │ 4. Compares:                │
                                 │    if expected === signature│
                                 │        ✅ Accept            │
                                 │    else                     │
                                 │        ❌ Reject            │
                                 └────────────────────────────┘
                                

---

## 🚀 How It Works

### 1. Sender
The webhook sender:
- Generates a `timestamp` and `nonce`.
- Builds a payload (JSON).
- Creates an HMAC signature:

```js
const signature = crypto
  .createHmac('sha256', WEBHOOK_SECRET)
  .update(`${timestamp}.${nonce}.${JSON.stringify(payload)}`)
  .digest('hex');

